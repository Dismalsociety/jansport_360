# Add these debugging prints after your R² calculation:
print(f"Predictions shape: {predictions_flat.shape}")
print(f"Targets shape: {targets_flat.shape}")
print(f"Predictions stats: mean={predictions_flat.mean():.2f}, std={predictions_flat.std():.2f}")
print(f"Targets stats: mean={targets_flat.mean():.2f}, std={targets_flat.std():.2f}")
print(f"SS_res (numerator): {ss_res:.2f}")
print(f"SS_tot (denominator): {ss_tot:.2f}")
print(f"Ratio SS_res/SS_tot: {ss_res/ss_tot:.4f}")

# Also try this alternative calculation:
mse = np.mean((targets_flat - predictions_flat) ** 2)
variance = np.var(targets_flat)
r2_alt = 1 - (mse / variance)
print(f"Alternative R²: {r2_alt:.4f}")

# And correlation coefficient:
correlation = np.corrcoef(predictions_flat, targets_flat)[0, 1]
print(f"Correlation coefficient: {correlation:.4f}")
