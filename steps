import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# Load original data
print("Loading data...")
df = pd.read_excel('stretched_training_data.xlsx')
times = df['Time (s)'].values
flows = df['Flow Rate (gpm)'].values

# Create step function instead of sine wave
# Step parameters
STEP_DURATION = 3  # How long each step lasts (seconds)
STEP_LEVELS = 5      # Number of different step levels

# Create stepped flow pattern
new_flows = []

for i in range(len(times)):
    # Which step are we in
    step_number = int(times[i] / STEP_DURATION)
    
    # Which level (0 to STEP_LEVELS-1)
    level = step_number % STEP_LEVELS
    
    # Calculate flow for this level
    # Level 0 = 0%, Level 1 = 25%, Level 2 = 50%, etc.
    level_fraction = level / (STEP_LEVELS - 1)
    
    # Apply to original flow rate
    stepped_flow = flows[i] * level_fraction
    new_flows.append(stepped_flow)

new_flows = np.array(new_flows)

# Save the new data
new_df = pd.DataFrame({
    'Time (s)': times,
    'Flow Rate (gpm)': new_flows,
})

new_df.to_excel('step_wave_training_data.xlsx', index=False)
print("Saved to step_wave_training_data.xlsx")
